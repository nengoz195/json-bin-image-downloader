<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JSON BIN Image Downloader</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #333; }
    input { margin: 10px 0; }
    .image-list { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px; }
    .image-item { border: 1px solid #ddd; padding: 5px; text-align: center; width: 150px; }
    .image-item img { max-width: 100%; max-height: 100px; display: block; margin: auto; }
    button { margin-top: 5px; padding: 5px 10px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>JSON BIN Image Downloader</h1>

  <input type="file" id="jsonFile" accept=".json,.bin">
  <button onclick="downloadAll()">Download All</button>

  <div id="images" class="image-list"></div>

  <script>
    let urls = [];

    document.getElementById('jsonFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(evt) {
        try {
          const text = evt.target.result;
          const json = JSON.parse(text);
          urls = extractUrls(json);
          renderImages(urls);
        } catch (err) {
          alert("Không đọc được JSON: " + err.message);
        }
      };
      reader.readAsText(file);
    });

    function extractUrls(json) {
      let results = [];
      function recurse(obj) {
        if (typeof obj === "object" && obj !== null) {
          for (let key in obj) {
            if (key === "url" && typeof obj[key] === "string") {
              results.push(obj[key]);
            } else {
              recurse(obj[key]);
            }
          }
        }
      }
      recurse(json);
      return results;
    }

    function renderImages(urls) {
      const container = document.getElementById('images');
      container.innerHTML = "";
      urls.forEach((u, i) => {
        const div = document.createElement("div");
        div.className = "image-item";
        div.innerHTML = `
          <img src="${u}" alt="image">
          <a href="${u}" download="image_${i+1}.jpg">
            <button>Tải ảnh ${i+1}</button>
          </a>
        `;
        container.appendChild(div);
      });
    }

    function downloadAll() {
      if (urls.length === 0) {
        alert("Chưa có ảnh để tải");
        return;
      }
      urls.forEach((u, i) => {
        const a = document.createElement("a");
        a.href = u;
        a.download = "image_" + (i+1) + ".jpg";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      });
    }
  </script>
</body>
</html>
